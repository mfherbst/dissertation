\chapter[Coulomb-Sturmian based quantum chemistry]%
{Initial results of Coulomb-Sturmian based quantum chemistry}
\label{ch:CSQChem}
\chapquote{%
The real problem is that programmers have spent far too much
time worrying about efficiency in the wrong places and at the
wrong times; premature optimization is the root of all evil
(or at least most of it) in programming.}
{Donald Knuth~(1928--present)}

In this chapter we will turn our attention to performing
quantum-chemical calculations using Coulomb-Strumian~(\CS) functions
as the discretisation basis in our Ritz-Galerkin ansatz.

The first section is concerned with the fundamental properties
of the Coulomb-Strumian basis,
i.e. the convergence behaviour of the computational results
when fundamental parameters of the basis are changed.
Our investigation focuses on finding sensible sets of parameters
for the computation of energies at the Hartree-Fock and MP2 level of theory
and concludes with a recommendation for Coulomb-Strumian basis
sets for computations of atoms of the second and third period.

The second section tries to contrast Coulomb-Strumian basis sets
with Gaussian basis sets.
\todoil{Extend once this section has been written}

Last but not least we will briefly look at a couple of examples,
where we computed excited states using Coulomb-Strumian basis sets
and try to hint that especially the description of $s$-like
Rydberg states in alkaline metals is a possible application
for Coulomb-Strumian basis sets.
\todoil{Extend and reword once the final section has been written}

\section{Convergence properties of Coulomb-Strumian basis sets}
For our initial investigation of Coulomb-Strumian basis sets
we have mainly focused on Hartree-Fock as well as MP2
calculations of the atoms of the second and third
row of the periodic table.
A few selected calculations at Full-CI level have also
been performed for reference and to compare the trends,
mostly with MP2.

Even though these methods represent only a small selection
of the wide-range of possible quantum-chemical methods,
we think that Hartree-Fock as a self-consistent field method
and MP2 to perturbatively capture correlation effects
provide good insight into what could be expected
for other single-reference ground state methods as well
if Coulomb-Strumian basis sets are to be used.

\newcommand{\nmax}{\ensuremath n_\text{max}}
\newcommand{\lmax}{\ensuremath l_\text{max}}
\newcommand{\mmax}{\ensuremath m_\text{max}}
For the following discussion let us briefly recap
that in general a Coulomb-Sturmian basis function
\begin{equation}
\chi_\mu(\vec{r}) = \mathcal{N}_\mu \,
	(2 \kexp \, r)^l \,
	L^{2l+1}_{n-l-1}(2 \kexp \, r) \,
	\exp(- \kexp \, r) \,
	Y_l^m(\theta, \varphi)
	\label{eqn:FormCSBasisFunction}
\end{equation}
with $L^{2l+1}_{n-l-1}$ being an associated Legendre polynomial,
$Y_l^m$ being a spherical harmonic and $\mathcal{N}_\mu$ being a normalisation
constant,
can be uniquely described by its quantum numbers $\mu \equiv (n,l,m)$
as well as the its Coulomb-Sturmian exponent $\kexp$ (\cf section \vref{sec:BasisCS}).
Since the exponent $\kexp$ is shared amongst all Coulomb-Strumians in a basis,
we can define a particular \CS basis
by specifying the common exponent $\kexp$
and the set of quantum number triples $(n, l, m)$ of all \CS basis functions
present in the basis set.

Theoretically any selection of quantum number triples for forming a basis
is possible.
In this work, however, we have restricted ourselves to basis sets of the form
\[ \big\{ (n, l, m) \, \big| \, n \le \nmax, l \le \lmax, -\mmax \le m \le \mmax \big\} \]
i.e. where all three quantum numbers are bound from above.
We will sometimes refer to such a \CS basis set by the triple
$(\nmax, \lmax, \mmax)$ of the three maximal quantum numbers itself.
In other words a $(3,2,2)$-basis set shall denote a basis set with
$\nmax = 3$, $\lmax = 2$ and $\mmax = 2$.

The selection to basis sets of this particular form is entirely arbitrary
and mainly done for the sake of reducing the search space at hand
and to get some initial insight into the properties \CS basis sets.

\subsection{Reference results}
\defineabbr{CBS}{CBS\xspace}{complete basis set limit}

In order to estimate errors as well as the quality of the \CS-based \HF
results obtained,
we compare against the reference values given in table \vref{tab:HFReference}.
For the closed-shell atoms we use the very accurate numerical RHF results
from \citet{Morgon1997}.
For the open-shell atoms we take the UHF complete basis set~(\CBS)
limit extrapolated from calculations using the Dunning cc-pV$n$Z family
of Gaussian basis sets and following the method of \citet{Jensen2005}.
See appendix \vref{apx:CbsLimit} for more details on the extrapolation
procedure which lead to the tabulated results.
\input{table_reference.tex}


\subsection{Convergence of \HF for full-shell \CS basis sets}
Let us use the term \newterm{shell} to refer to the set
\[ \{ \chi_{n'l'm'} \, | \, n' = n \} \]
of \CS basis functions with the same principle quantum number
in analogy of the same term used for hydrogenic orbitals.
Naturally this allows us to build up a \CS basis set by considering
all the shells up to and including the $\nmax$-th shell.
The result is a \newterm{full-shell} \CS basis of the type
\[ \{ \chi_{n'l'm'} \, | \, n' \leq \nmax \}. \]

\begin{figure}
	\centering
	\includeimage{10_results/Delta_EHF_vs_shell}
	\caption{
		Plot of the error in the \HF energy vs the number of basis
		functions in the full-shell \CS basis containing
		the specified number of shells.
		As the error we use the absolute error between \CS-based \HF energy
		$E_\text{HF}^\text{CS}$ as well as the reference value
		$E_\text{HF}^\text{ref}$ of table \vref{tab:HFReference}.
		For the closed-shell atoms Be and Ne restricted \HF results are shown,
		whereas for all other open-shell systems unrestricted \HF results
		are plotted.
		All energies are given in Hartree
		and the $y$-axis has a logarithmic scaling.
}
	\label{fig:ErrorHF_vs_shell}
\end{figure}
By the means of the similarity between the \CS basis and the actual
hydrogenic orbitals,
we would expect such a basis to show convergence to the reference \HF result.
In fact this is more or less what is observed:
Figure \vref{fig:ErrorHF_vs_shell} shows the absolute error in the \HF energy
for the second period versus the number of basis functions.
Even though the convergence rate drops visibly
over the selected sequence of basis functions,
we still clearly note the systematic convergence over the progression
of basis functions.

The question is now if and how we could improve this convergence rate.
From a physical point of view,
we would not expect all angular momentum to be equally important
for the description of the electronic structure of a particular atom.
In beryllium for example we would imagine that only $l == 0$ is really required,
since a ground state beryllium atom only has the 1s and the 2s orbitals occupied,
which of course both have only $l == 0$.
To investigate this more quantitatively,
let us introduce the \newterm{root mean square occupied coefficient}
per angular momentum $l$:

\defineabbr{RMS}{RMS\xspace}{root mean square}
\newcommand{\RMSOl}{\text{RMSO}_l}
\begin{defn}
	The root mean square~(\RMS) occupied coefficient per angular momentum $l$
	is the quantity
	\begin{equation}
	\RMSOl =
		\sqrt{
		\sum_{(n,l,m) \in \Ibas} \
		\sum_{i \in \IoccA} \frac{1}{\NelecA \ N_{\text{bas}, l}}
			\Big(C^\alpha_{nlm, i} \Big)^2
			+ \sum_{i \in \IoccB} \frac{1}{\NelecB \ N_{\text{bas}, l}}
			\Big( C^\beta_{nlm, i} \Big)^2
		}
		\label{eqn:DefRMSOl}
	\end{equation}
	where $C^\alpha_{\mu i}$ and $C^\beta_{\mu i}$
	are the orbital coefficients of the $\alpha$ and $\beta$ orbitals
	(see \eqref{eqn:HFCoeffMatrix})
	and
	\[
		N_{\text{bas}, l} := \abs{ \left\{ (n',l',m') \, \big|\, (n',l',m') \in \Ibas
			\ \text{and} \ l' = l \right\} }
	\]
	is the number of basis functions in the \CS basis which has angular momentum
	quantum number $l$.
\end{defn}
Since $\RMSOl$ is the \RMS-averaged coefficient for a particular angular
momentum quantum number $l$ in the occupied SCF orbitals,
it provides a measure for the importance of the \CS basis functions
with quantum number $l$ for the description of this particular system.
Loosely speaking a drop in $\RMSOl$ to values below the
accuracy desired for the calculation indicates that basis functions with
this value of $l$ can be omitted from the basis without a change in \HF energy.

\begin{figure}
	\centering
	\includeimage{10_results/rmso_period2_vs_l}
	\caption{Plot $\RMSOl$ vs $l$ for $nlm = 655$ and period 2}
	\label{fig:RMSOl_period2}
\end{figure}

\begin{figure}
	\centering
	\includeimage{10_results/rmso_period3_vs_l}
	\caption{Plot $\RMSOl$ vs $l$ for $nlm = 655$ and period 3}
	\label{fig:RMSOl_period3}
\end{figure}
Let us now consider the neutral atoms of the second and third period of
the periodic table in a $(6,5,5)$ \CS basis set.
If we plot $\RMSOl$ vs $l$ like in figures \vref{fig:RMSOl_period2}
and \vref{fig:RMSOl_period3}, we observe two types of behaviour.

Those atoms which consist of a fully filled or half-filled valence subshell
, i.e. Li, Be, N, Ne and Na, Mg, P and Ar,
show a very distinct drop in $\RMSOl$ once a certain value
for $l$ is reached.
This suggests that for lithium and beryllium only $l=0$,
i.e. $s$-functions are required for a description of these atoms,
whilst for the others we only need $l \leq 1$, i.e. $s$- and $p$-functions.
This is in perfect agreement to what one would expected
considering the Aufbau principle and the Madelung rule
\todoil{Maybe briefly explain Madelung rule}
for atoms,
since these principles suggest that only $s$ and $p$-orbitals will be
occupied for the second and third period of the periodic table.

On the other hand the atoms which do not consist
of a closed or half-filled subshell,
i.e. B, C, O, F and Al, Si, S, Cl,
only show a rather moderate decrease in $\RMSOl$ over the range of the plot.
% TODO HERE



The first kind applies for closed-shell atoms or atoms
with a half-filled subshell


Half-filled 2p or 3p subshell
or closed-shell

% Look up in Keeler Wothers
Elements which have a closed-shell or half-full-shell 


If we plot $\RMSOl$ vs $l$ for the neutral atoms of the
second and the third period
we observe a clear drop in $\RMSOl$ only for the closed-shell
and the half-closed-shell systems,
that is Li, Be, N, Ne, Na, Mg, P and Ar.
For all other systems the drop in $\RMSOl$ is only comparatively slow.







For this let us consider at first the relationship of the number of basis
functions $\Nbas$ in a \CS basis including all shells up to $\nmax$.
We find
\begin{align}
	\nonumber
	\Nbas(\nmax) &= \sum_{n=1}^{\nmax} \sum_{l=0}^{n-1} \sum_{m=-l}^l 1
		= \sum_{n=1}^{\nmax} \sum_{l=0}^{n-1} 2l+1 \\
		&= \sum_{n=1}^{\nmax} n^2
		= \frac{(2\nmax+1)(\nmax+1)\nmax}{6}
		\in \bigO(\nmax^3),
	\label{eqn:NbaxFullShellBasis}
\end{align}
i.e. a dependency as the third power of $\nmax$.
In contrast a basis, which is not only limited by $\nmax$, but by $\lmax$ as well,
exhibits only a linear dependency of $\Nbas$ wrt. $\nmax$, namely
\begin{align}
	\nonumber
	\Nbas(\nmax) &= \sum_{n=1}^{\nmax} \ \sum_{l=0}^{\min(\lmax, n-1)} 2l + 1 \\
	&= \sum_{n=1}^{\nmax} \Big( \min(\lmax+1, n) \Big)^2 \\
	\nonumber
	&\le \sum_{n=1}^{\nmax} (\lmax+1)^2 = (\nmax-1) (\lmax+1)^2
	\in \bigO(\nmax \lmax^2).
\end{align}
In other words if we manage to find a particular value for $\lmax$,
for which





As we will show now,
for many atoms it is sensible to limit both $\nmax$ as well as $\lmax$
as the \CS basis functions with large values of $l$ are not selected
by the SCF procedure for the occupied MOs.
Leaving them out hence typically does not effect convergence.
What this implies is that for these atoms the convergence rate
will be increased by choosing a basis with $\nmax$ and $\lmax$ restriced.


% The argument is that we want to explain the reduced convergence
% rate by saying that the basis grows as n^3 whilst
% only some of the l values really play a role, i.e.
% if we restrict l as well we could get something growing only linearly in n






If we would leave the terrain of full-shell basis sets
and allow ourselves to limit the maximal angular momentum quantum
number as well by a constant $\lmax$ as introduced above,
then the number of basis functions scales as
\begin{align*}
\sum_{n=1}^{\nmax} \ \sum_{l=0}^{\min(\lmax, n-1)} 2l + 1
	&= \sum_{n=1}^{\nmax} \Big( \min(\lmax+1, n) \Big)^2 \\
	&\le \sum_{n=1}^{\nmax} (\lmax+1)^2 = (\nmax-1) (\lmax+1)^2
	\in \bigO(\nmax \lmax^2)
\end{align*}
in other words only increases linearly with $\nmax$.

It turns out that for some cases like beryllium and nitrogen
such an approach is very much justified.
In order to see this let us introduce the
\newterm{root mean square occupied coefficient}
per angular momentum $l$:

\begin{figure}
	\centering
	\includeimage{10_results/rmso_ions_vs_l}
	\caption{Plot $\RMSOl$ vs $l$ for $nlm = 766$ and the ions}
	\label{fig:RMSOl_ions}
\end{figure}

Loosely speaking $\RMSOl$ gives us the importance of the basis functions
with angular momentum quantum number $l$ in the \CS basis set.
This idea motivates the next definition

\newcommand{\limp}{l_\text{imp}}
\begin{defn}
	The \newterm{largest important angular momentum quantum number} is the value
	\[ \limp = \sup \{ l \, | \, (n,l,m) \in \Ibas \ \text{and} \ \RMSOl > \epsilonconv \}, \]
	i.e. the largest $l$ for which the coefficients are still larger than the
	desired accuracy of the SCF procedure.
\end{defn}

If we look at \vref{fig:RMSO_period2_l} we notice
that for lithium and beryllium pretty much all angular momentum
except $l = 0$ and $l = 1$ is unimportant.
Similarly for nitrogen and neon.
For the remaining atoms of the second period,
boron, carbon, oxygen and fluorine, however,
even angular momentum $l=5$ is reasonably important and the
decay of $\RMSOl$ is much less pronounced.
In either case this hints that the rate of convergence might
be improved for cases like beryllium
if a restriction is imposed on the principle angular momentum
quantum number $l$ as well.

This behaviour of carbon and fluorine is known.
See \citet{Cook1981}
and this is a general problem of UHF~\citet{Cook1984}.
See also \citet{McWeeny1985}.
\citet{Fukutome1981} provides a very detailed discussion of the
effects of symmetry-breaking in HF wavefunctions like for example in UHF.
\label{sec:IssuesUHF}
% coupling only to l+2 and the same m
% so we could shrink the basis by imposing that restriction!
% The states can be stationary or unstable points rather then minimaA
%
% Tho odd-even pattern can be explained by considering the parity
% of the wave function of that particular orbital. Even l have even parity
% and odd l have odd parity. Linear combination of functions of even
% and odd parity breks M_L symmetry (???)

In fact analoguous calculations using Gaussian basis sets reveal,
that the same effect occurs if UHF is used.
See \vref{apx:GaussianUHF} for equivalent plots to figures \vref{fig:RMSO_period1},
\vref{fig:RMSO_period2},  \vref{fig:RMSLF_N}, \vref{fig:RMSLF_C}, \vref{fig:RMSLF_O}
using Dunning basis sets.

% TODO Show by similar analysis that we also have the problem for Gaussians
% Indeed that is true for gaussians as well!


% Sometimes we do not only have this issue, but the SCF also does not converge to
% a minimum but only a saddle point that way, so we need to force convergence using a DIIS.

\todo[inline,caption={}]{
	\begin{itemize}
		\item Also look at ions \ce{O+}, \ce{F-}, \ce{C-}, \ce{B+} to show that its
			to do with the occupation
	\end{itemize}
}

\begin{figure}
	\centering
	\includeimage{10_results/rms_lf_N}
	\caption{Plot root mean square coefficient vs $l$ and orbital index for N}
	\label{fig:RMSLF_N}
\end{figure}

\begin{figure}
	\centering
	\includeimage{10_results/rms_lf_C}
	\caption{Plot root mean square coefficient vs $l$ and orbital index for C}
	\label{fig:RMSLF_C}
\end{figure}

\begin{figure}
	\centering
	\includeimage{10_results/rms_lf_O}
	\caption{Plot root mean square coefficient vs $l$ and orbital index for O}
	\label{fig:RMSLF_O}
\end{figure}

\todo[inline,caption={}]{
	\begin{itemize}
		\item It seems that the full and half-full shells are ok and the $\RMSOl$
			decays rather early and in agreement with the chemical intution,
			but all others this is not the case
		\item Any clue why?
		\item \emph{Could} be something to do with the restricted vs unrestricted
			issue. See TODO in the next section.
	\end{itemize}
}

\subsection{Convergence of \HF for \CS basis sets with $\nmax$ and $\lmax$}
% Hint at the general property James mentioned


From the discussion of the previous section
it becomes clear that at least in some cases it makes sense to
limit not only $\nmax$, but on top of that $\lmax$ as well.
For example for beryllium the error
in the Hartree-Fock energy is pretty much unchanged if the
restriction $\lmax = 1$ is imposed onto the full-shell \CS basis sets as well.
This can be seen in figure \vref{fig:ErrorHF_vs_nlm}
where we again show the error in HF energy compared to the reference
as specified in table \vref{tab:HFReference},
but we look at basis sets with a particular $\lmax < \nmax$ now.

\begin{figure}
	\centering
	\includeimage{10_results/ehf_vs_nlm}
	\caption{Plot relative error in $E_\text{HF}$ vs $\Nbas$.
		The reference is mentaioned in \vref{tab:HFReference}.}
	\label{fig:ErrorHF_vs_nlm}
\end{figure}

% Plot the same elements or the same basis set kinds with the same color.

\begin{figure}
	\centering
	\includeimage{10_results/ehf_vs_nlm_O}
	\caption{Plot relative error in $E_\text{HF}$ vs $\Nbas$}
	\label{fig:ErrorHF_vs_nlm_O}
\end{figure}

As can be seen the convergence is greatly improved
for nitrogen, beryllium and phosphorus
if we limit ourselves to $\lmax = 1$
in accordance with the observation we made in fig.
\vref{fig:RMSO_period2_l}.
For nitrogen two convergence curves are shown,
one with the limit $\lmax = 2$ and one with $\lmax = 1$.
Note that the difference in \HF error in both cases
is really negligible, whilst the rate of convergence is
surely much faster for $\lmax = 1$.

\defineabbr{AM}{AM\xspace}{angular momentum}
This implies that at least for the well-behaving cases,
i.e. where the $\limp \le 2$,
the convergence pretty much only depends on the value
of $n$ and thus a systematic construction of basis
sets which solve the \HF equations up to a certain
desired accuracy should be possible for these cases.

For O where we know that higher angular momentum is important, too,
the effect of truncating the angular momentum can be observed.
For $\lmax = 1$ the convergence initially is almost linear,
but than quickly stagnates and the error does not improve for larger
values of $\nmax$ any more. The same thing happens for
$\lmax = 2$ just at a larger value of $n$.
Generally one should note that in the examples shown
the errors in HF energy are still comparatively large,
namely in the order of Millihartrees even for the largest
basis sets employed for oxygen.

The correlation between $\RMSOl$ and the lowest error which can be
achieved for a given $\lmax$ is interesting to note.
$\text{RMSO}_2$ and $\text{RMSO}_3$ are of a similar size for oxygen
whilst there is a decrease by about 2 orders of magnitude going
from $\text{RMSO}_3$ to $\text{RMSO}_4$.
This also reflected by the fact that we do not gain a much better
result choosing $\lmax = 2$ instead of $\lmax = 1$
the error values stagnate at about the same value.
For $\lmax = 3$ on the other hand linear convergence is obtained
up to a much smaller error value.

\todoil{Maybe make a similar plot to fig. \vref{fig:ErrorHF_vs_nlm}
showing the relative errors of the orbital energies compared
to reference results in N or O or so.
Show how the orbital energies are approximated from above.
This would help in understanding the signifficance of the coefficients
wrt. correlation methods as well.
}

% TODO orbital energy convergence?
% TODO Not sure if this way of plotting is ideal.
\begin{figure}
	\centering
	\includeimage{10_results/orben_vs_nlm_N}
	\caption{Plot relative difference in the orbital energy vs $n$.
		The relative difference is $1 - \varepsilon_i^{(n)} / \varepsilon_i^{(n+1)}$
		for N.
	}
	\label{fig:OrbenNlmN}
\end{figure}

\todo[inline,caption={}]{
	I get the feeling the bad convergence for oxygen and the other
	open-shell systems is because we use UHF,
	which implicitly causes other determinants to be mixed into the HF
	solution.
	Some literature suggests that UHF destroys the rotational symmetry.
	\begin{itemize}
		\item Try to code a rudimentary ROHF and check weather things are better there
	\end{itemize}
}
% Spin squared values:
%       should    is
%  Li   0.75       0.7500174679889692
%  Be   0
%  B    0.75       0.7535472111793353
%  C    2          2.00941178981773
%  N    3.75       3.755922043215328
%  O    2          2.006538441200304
%  F    1.75       0.7530439372523485

\subsection{$m$-tuning for oxygen and carbon}
Do the calculation of 8.7 but truncate m=1, m=2

Does not really seem to do the trick

\subsection{$n,l,m$ recommendations for HF}
Pretty much $(n, 0, 0)$ up to Be, $(n, 1, 1)$ for N and Ne, Na, Mg, P, Ar.
For the rest $(n, 2, 2)$ at least for description up to error less than $1e-4$
$(n, 3, 3)$ if lower error (down to $1e-6$ is desired.

\subsection{Convergence taking electron correlation into account}

% TODO
% Plot MP2 correlation energy vs. Nbas for the computations we did on manjula
% converge_correlation. Annotate the points with the actual basis set used.
% Use this plot to justify the choice of basis in the nlm sense for the
% different elements.


Another aspect to note is that hardly ever one is interested
in the exact description of the one-determinantal \HF solution.
Much of the chemistry which takes place happens due to effects originating
from electron-electron correlation.
In this section we will therefore try to hint at the convergence effects
in Full-CI or MP2 calculations with \CS basis sets.

Note, that we have so far not performed conclusive convergence studies
on these results, so especially for the difficult cases,
i.e. where $\limp > 2$,
the results are extremely preliminary.

\begin{figure}
	\centering
	\includeimage{10_results/Be_fci_cc_vs_nbas}
	\caption{Fraction of correlation energy recovered
		relative to a FCI reference calculation with a $(10, 2, 2)$ \CS basis
		and $\kexp = 2.1$ in beryllium.}
	\label{fig:EccFciBe}
\end{figure}
Table of results in appendix \vref{apx:CSCorrelationConvergence}

% TODO Plot MP2 and FCI correlation energy amount

Table \vref{tab:CStruncationEnergies} shows the \HF, MP2 and
Full-CI energies for various \CS basis sets.
As expected from our previous discussion,
the \HF energy does not depend very much on the choice
of $\lmax$ and $\mmax$ as long as both values
are large enough to incorporate the orbitals with $l \leq \limp$.
Since for beryllium $\limp$ is either $1$ or $0$
(for a large SCF convergence threshold $\epsilonconv$),
the HF energy is indifferent
to the values of $\lmax$ and $\mmax$.

For the methods including electron-electron correlation,
i.e. MP2 and Full-CI,
we see that they show largely the same trends
when it comes to the value of the electronic correlation obtained.
We will therefore assume from now onwards
that MP2 is a sensible description
for the correlation effects of \CS basis sets.
This observation should be taken with a grain
of salt
as we already found out,
that Be is one of the nicely-behaving atoms.

One should point out again that for the description
of correlation effects, the effect of increasing $\nmax$
is generally more significant than increasing
$\lmax$ once a certain value of $\lmax$ has been reached
(here about 2).

In appendix \vref{apx:CSCorrelationConvergence} we show
some computational results for the 2nd and 3rd
period of the periodic system of elements.

\todo[inline,caption={}]{
	\begin{itemize}
		\item I would like to say that FCI and MP2 agree for Be
		\item Hence we can use MP2 to characterise how CS capture correlation effects
		\item Kind of does not work except the well-behaving cases as the results jump around
		\item Still some suggestions that we can get away with basis sets of the kind
			$\mmax = \lmax-1$ in some cases.
		\item I feel we should show the results in a nicer manor
			emphasizing the important features,
			but I kind of fail to see trends.
	\end{itemize}
}

\begin{figure}
	\centering
	\includeimage{10_results/Ecc_vs_bas_easy}
	\caption{Fraction of MP2 correlation energy recovered
		relative to the calculation with a $(6,3,3)$ \CS basis for
		atoms with a full or half-full shell in the second and third period.}
	\label{fig:EccVsNlmEasy}
\end{figure}

\begin{figure}
	\centering
	\includeimage{10_results/Ecc_vs_bas_hard}
	\caption{Fraction of MP2 correlation energy recovered
		relative to the calculation with a $(6,4,4)$ \CS basis for
		atoms with one or two unpaired electrons.}
	\label{fig:EccVsNlmHard}
\end{figure}

For the full set of value see appendix \vref{apx:CSCorrelationConvergence}

\newcommand{\kopt}{\ensuremath k_\text{opt}}
\subsection{The effect of $\kexp$}
For the remaining discussion in this sections
we have limited ourselves to rather small basis sets,
that is we typically set $\lmax$ and $\mmax$ to values
of 2 or less and $\nmax$ not larger than 6
to save computational time.
This should be a reasonable compromise,
but further investigation has to show this.

As can be seen in figure \vref{fig:EnergyTermsVsK}
Smaller values of $\kexp$ lead to a slower decay of the orbitals,
hence the electrons are forced to reside at a more
distant place to the nucleus on average,
which in turn leads to a rise in nuclear attraction energy.
On the other hand larger $\kexp$ lead to more compressed orbitals,
which drives up the repulsive coulomb interaction as well as the kinetic energy.

\begin{figure}
	\centering
	\includeimage{10_results/EHF_terms_vs_k}
	\caption{Terms of the \HF calculation vs $\kexp$ for Be with a $(5,1,1)$ \CS basis}
	\label{fig:EnergyTermsVsK}
\end{figure}
% TODO Electron-electron interaction mostly agnostic to k, a little lower with smaller k (i.e. larger orbitals)

The net result for \HF as well as MP2 and FCI is shown in figure \vref{fig:FCI_vs_k}.
One easily notices that the dependency of the energy wrt. $\kexp$ is a
convex curve.
Notice, that the optimal exponent $\kexp$ for the FCI S1 ground state
is larger than the optimal exponent $\kexp$ for the description
of the HF ground state.
MP2 is in between but much closer to HF.

\begin{figure}
	\centering
	\includeimage{10_results/Efci_vs_k}
	\caption{Energies vs $\kexp$ for Be with a $(5,1,1)$ \CS basis}
	\label{fig:FCI_vs_k}
\end{figure}

The optimal value for $\kexp$ is very much dependent on the
precise state.
For the T1 state for example, the optimal $\kexp$
is around the value for HF.

As can be seen in figure \vref{fig:EHF_vs_k}
for carbon,
$\kopt$ depends on the choice of the basis as well.
Generally speaking larger basis sets will favour
smaller values of $\kopt$.
This can be explained by the fact that \CS basis sets
all share the same exponent.
Since the largest contribution of the \HF energy
originates from the nuclear attraction energy,
small basis sets will overemphasize
the nuclear attraction interaction,
i.e. they will tend to larger values for $\kopt$
in order to minimise the nuclear attraction energy.
As the basis becomes larger,
the extra basis functions allow for a balanced
description of both the nuclear attraction
as well as the electron repulsion
and kinetic energy terms,
which therefore allows to choose a smaller $\kopt$.

\begin{figure}
	\centering
	\includeimage{C_ene_gs_vs_k}
	\caption{\HF energy vs $\kexp$ for a couple of basis sets and carbon.}
	% Maybe do not have the minimum annotated in the graph but only have in
	% the text instead
	\label{fig:EHF_vs_k}
\end{figure}
Figure \vref{fig:EHF_vs_k} shows the change in the curvature
of the energy vs. $\kexp$ graphs as the basis set size is increased.
Generally speaking the curves become flatter and both the values of the
\HF as well as the MP2 energies become more agnostic to the precise value of $\kexp$.
Furthermore the optimal value for $\kexp$ shifts towards smaller values.
This can be explained by the fact that with larger basis sets
the basis has more freedom to represent both the core and the valence-like orbitals.
Since the core-like orbitals, which are more contracted (larger $\kexp$, contribute
larger to this energy, the small basis will choose a larger $\kexp$.
Equivalently one can consider the dependence of the nuclear attraction
energy wrt. $\kexp$.

Another fact worth mentioning is that the MP2 correlation energy typically
is much less dependant on too large values of $\kexp$ than too small values
of $\kexp$.
So for a correlated treatment of the carbon atom a too large value for $\kexp$
is better than a too small value.
In agreement with this recommendation is the realisation that
MP2 calculations tend to have a larger $\kopt$ value, hence tending a bit more
towards the FCI value for $\kopt$.
Therefore if the \HF value for $\kexp$ is choosen larger than the optimum,
the correlated treatment typically even benefits from this a bit.


\begin{figure}
	\centering
	\includeimage{C_hfterms_vs_k}
	\caption{HF energy terms vs $\kexp$ for different basis sets}
	\label{fig:Eterms_vs_k}
\end{figure}

In figure \vref{fig:Eterms_vs_k} we observe the same trends
as in figure \vref{fig:EnergyTermsVsK} for beryllium
just with the difference that
the result is shown for different basis sets.
We observe that the trends get smaller if larger basis sets are chosen.


\begin{figure}
	\centering
	\includeimage{C_orben_622_vs_k}
	\caption{E orbital vs k, only alpha orbitals are plotted of 622}
	\label{fig:orben_vs_k}
\end{figure}

The interpretation of the orbital energy vs $\kopt$ curve
should be done with care.
For this note that the minimal sum of the orbital energies
occurs at a much smaller value for $\kopt$,
since the electron-electron interactions are counted twice
hence shifting the optimal value for the sum of the orbital
energies more towards smaller $\kexp$.

Nevertheless it allows us to qualitatively assess the realisation
that for the description of the virtual or valence states
smaller $\kopt$ values are preferable wlist for the core states
larger $\kopt$ are typically preferred.
Again since the core-like orbitals have a bigger contribution
to the energy typically small basis sets tend to try to represent
these in a good fashion first, hence tending to larger values of $\kopt$.
Whilst the $\kopt$ decreases as the basis gets larger up to the point
where its precise value becomes less and less important.


\todo[inline,caption={}]{
	\begin{itemize}
		\item Optimal k for HF and MP2 is similar
		\item For FCI a bit larger
		\item For MP2 grows
		\item With larger basis set optimal k gets smaller
		\item optimal k for orbitals smaller than for HF energy in general
		\item Core-like states favour larger k
	\end{itemize}
}


\subsection{Determining the optimal exponent $\kopt$}
Due to the convexity of the curve energy-vs-k (see \vref{fig:FCI_vs_k})
and the fact that we are dealing with a scalar function,
the optimisation of the energy wrt. $k$ can be performed by
Brent's method~\cite{Brent1972},
which does not require energy derivatives.

For \CS basis sets the core hamiltonian guess is in many cases not very good
in the sense that it can give rise to the wrong SCF minimum.
A good example to reproduce this is beryllium with a $(3, 2, 2)$ \CS basis
set and $\kexp = 1.9$.
Note that this exponent is only $0.1$ from the optimal one,
but nevertheless hcore fails.
This behaviour is retained for $(4,2,2)$ and $(5,2,2)$ basis sets,
which are already quite reasonable for beryllium.

In a similar manor especially for the atoms of the third
period the SCF stationary point obtained with \molsturm
is very much dependent on the values of $\kexp$ and $(n,l,m)$.
If we get humps on the surface because we fall from one SCF
minimum to another,
the optimisation for $\kexp$ typically produces erroneous results.

In other words the key starting point for finding $\kopt$
is to obtain a reliable guess for the atom.
Our approach is to start 5 SCF calculations with the
selected \CS basis set at two values of $\kexp$:
One supplied by the user and one guessed from the \HF orbital
energies of the first calculation.
Out of these randomly initialised SCF calculations,
the lowest-energy version is taken as the guess
for all SCF calculations performed during the search
of Brent's method.
Typically this converges within 10 iteration steps
to $\kopt$.

The heuristic for finding a reasonable value for
$\kopt$ from \HF energies follows the idea that the
energy of an orbital is related to its decay at infinite distance
according to Kato
\todo{cite}.
In other words, since this is the case for sturmians, too,
we get that the energy of an orbital is related to its optimal
exponent by
\[
	\varepsilon_i = -\frac{k_i^2}{2}
\]
thus
\[
	k_i = \sqrt{-2 \varepsilon_i}
\]
and since we have many of these $\varepsilon$:
\[
	\kopt \simeq \sqrt{\frac{-2}{\Nelec} \sum_i \varepsilon_i}
\]

This guess method is implemented in \molsturm in the
module \texttt{molsturm.scf\_guess}
as the function \texttt{best\_of\_n} and the method
for finding the optimal value of $\kexp$ is implemented
as \texttt{molsturm.sturmian.cs.find\_kopt}

\subsection{Discussion of the values for $\kopt$}
\label{sec:ValuesKopt}
% Introduce relationship to shielding and slaters / clementis work
% establish: effective nuclear charge increases across the period
% due to averaging trends become less apparent as we move to larger period numbers

Figure \vref{fig:KoptVsAtnum} shows the optimal Coulomb-Strumian exponents
for the neutral atoms across the second and the third period of the periodic table.
As can be seen the values for $\kopt$ follow a rough linear increase
as we go from the alkaline metals to the noble gases,
where the slope of the increase is steeper along the second period.
Note, however, that a deviation from this linear trend
is very much apparent in the third period.

\citet{Slater1930} introduces the concept of a nuclear shielding parameter $\sigma$
in order to construct simple analytic expressions of the form
\begin{equation}
	\chi_{n^\ast, \sigma} = r^{n^\ast - 1} \exp\left( - \frac{(Z - \sigma)r}{n^\ast} \right)
	\equiv r^{n^\ast - 1} \exp\left( -\zeta r\right)
	\label{eqn:SlaterShielding}
\end{equation}
for the atomic orbitals.
\citet{Clementi1963} later determined optimal values for the Slater exponents $\zeta$
by performing \HF calculations,
variationally optimising to yield the lowest energy.
We will refer to these exponents as $\zeta_\text{Clementi}$ in this section.

Comparing \eqref{eqn:SlaterShielding} and \eqref{eqn:FormCSBasisFunction}
we easily note that $\kexp$ more or less plays the role of $\zeta$
with the subtle difference that for \CS basis sets all functions
need to carry the same exponent.
Nevertheless the procedure we follow to find $\kopt$ and the procedure
\citeauthor{Clementi1963} followed to find $\zeta_\text{Clementi}$
bears a lot of resemblance.

As a result it is not surprising that the behaviour of $\kopt$
along the periodic table is related to $\zeta_\text{Clementi}$ as well.
In fact it kind of forms a middle ground between the $\zeta_\text{Clementi}$
value of the HOAO, the highest occupied atomic orbital,
and the occupation-averaged value for $\zeta_\text{Clementi}$
when it comes to the trends observed.
Naturally its actual value is closer to the occupation-average
of $\zeta_\text{Clementi}$,
since we are forced to a single $\kexp$ value.
Therefore the optimal exponent $\kopt$ bears resemblance of both
the occupation-averaged value of $Z_\text{eff} / n^\ast$
as well as the trends of $Z_\text{eff} / n^\ast$ of highest occupied
atomic orbitals.

Note that by Slater's original definition,
we can identify the relationship
\[ Z_\text{eff} = n^\ast \zeta_\text{Clementi} \]
between the effective nuclear charge $Z_\text{eff}$ and
the optimal exponents $\zeta_\text{Clementi}$~\cite{Slater1930},
where $n^\ast$ is a function of the quantum number $n$ of the orbital
under consideration.
By means of a similar rationale to what has been sketched above,
we can therefore find a chemical interpretation for $\kopt$,
namely that it gives an understanding of the average
charge which is felt by the orbitals of a particular atom
or in other words the average shielding which takes place in the atom.
\todoil{Can one state it like that?}

\begin{figure}
	\centering
	\includeimage{10_results/kopt_vs_atnum}
	\caption{Plot of the atomic number versus the optimal Coulomb-Sturmian exponent
		$\kopt$ for the neutral atoms of the second and the third period.
		For comparison the occupation-averaged value of the \citet{Clementi1963} optimal
		Slater exponent $\zeta_\text{Clementi}$ as well as the
		value $\zeta_\text{Clementi}$ for the highest occupied atomic orbital~(HOAO)
		are shown.
	}
	\label{fig:KoptVsAtnum}
\end{figure}

Note that the slope of the graph $\kopt$ vs atomic number in the third period
is much more flat than the equivalent graph in the second period.
We can understand that by considering once again
that $\kopt$ gives an average over all orbitals.
Since especially the low-energy orbitals close to the nucleus
are shielded very little,
their value of $\kopt$ increases constantly along the periodic table.
The $\kopt$ for the valence orbitals, however, changes much more.
Especially at the beginning of the period, where atomic radii are large,
the $\kopt$ for the valence orbitals are small,
whilst this changes as the atoms get smaller across the period
and hence $\zeta_\text{Clementi}$ and $\kopt$ get larger.
This effect is diminished, however,
by the constant $\kopt$ increase of the
much larger number of core-like orbitals
and thus the rate of change of $\kopt$ across a period gets smaller,
the slope thus smaller as well.
Furthermore this implies that the rapid $\kopt$ change
going from one period to the next (e.g. Ne to Na)
will get smaller and smaller as well
as the effect of the valence-like orbitals gets averaged out.

An alternative way of viewing this is
that as a new shell becomes occupied it requires
the representation of an extra (more expanded) orbital.
So initially $\kexp$ gets reduced.
As we move across the period the nuclear charge increases
and since the shielding abilities of electrons in the same shell
is not that strong the orbitals become more contracted and occupy less space
thus $\kexp$ increases again.
As we move to larger periods this effect of change is averaged out
again by the more constant core-like orbitals.

Yet a third line of argument is the importance of nuclear attraction
vs. kinetic energy.
As the effective charge increases across the period
nuclear attraction becomes more and more important leading to larger values of $k$
(which support a larger (negative) magnitude of nuclear attraction energy)
and kinetic energy (which would favour smaller $k$) becomes less important.

\subsection{Suggestions for Coulomb-Sturmian basis sets}
% TODO Table of optimal values for k per basis set.
%      together with their energy and a comparison to literature and UHF values
%      create the UHF values via a CBL expansion from cc-pvNz calculations with Orca
%      N = 5, 6, 7 maybe. Do this for RHF and closed-shell as well to see the difference
%      This probably should be at the end of the chapter leading over to the comparison
%      with the Gaussians

\include{table_kopt}

See table \vref{tab:Kopt2} and table \vref{tab:Kopt3} % and table \vref{tab:Kopt4}


% Note that molsturm uses the fitted kopt values as a builtin ad hoc estimate
	% Explain procedure for finding the optimal k
	% explain justification for the "out of my hat formula"
	% comapare with various definitions of Z_eff
	% compare with solution to 1-electron hydrogenic equation energy scaling with Z



% Show and discuss the ideal exponent
% Maybe hint at or suggest good values for nlm

% Since the CS are complete in the radial part,
% we can essentially select sensible values for l and m and converge them
% with respect to these quantities thereby determining suggested values for l and m
% for other types of basis functions as well.
% => AM choice should apply to gaussians (and fe and \ldots), too!


Procedure:
\begin{enumerate}
	\item Find a not too small and not too large basis
	\item Optimise k
	\item Compute at optimal k a full-shell basis set
	\item find $\RMSOl$
	\item limit $\lmax$ and $\mmax$ properly
	\item Go to large-enough value for $\nmax$ to reach desired convergence
\end{enumerate}

\subsection{A word about the physics and the chemistry}
Let us briefly recall that Coulomb-Sturmians are the result of
solving equation \eqref{eqn:CSEquation},
which is very much related to the Schrödinger equation for hydrogenic atoms.
Most importantly the angular part of both the Coulomb-Sturmian
as well as the solution to the hydrogenic problem (see section \vref{sec:HydrogenAtom})
is the same, namely a spherical harmonic $Y_l^m$.
Along this lines we would expect that the \CS basis functions
which are most important to describe the electronic structure
of an atom are related to the quantum numbers expected
for the occupied atomic orbitals in this atom by the Aufbau principle
or the Madelung rule.



A very remarkable features of the CS basis is how well it captures all the expectations
from the chemical and phyisical behaviour, even though this has not been taken
into account in the above consideration, all chemical trends of the
periodic table which are known are nicely reproduced and hence
we would guess, that they are very good at capturing chemical effects as well.

\todo[inline,caption={}]{
	\begin{itemize}
		\item Compute Sturmian k-dependence for more than one example
		\item Contrast the results for the periodic table?
	\end{itemize}

	% Explain shape of E-vs-k graph:
	% large k favour valance orbitals and disfavour core-like orbitals
	% kmall k vice versa
	% valance orbitals have smaller contribution to the HF energy
	% Hence steeper slope at small k side
	%
	% Hence more complete basis leads to smaller kopt
	%    - Since more basis functions the large-k contributions are represented
	%      in the extra basis functions with larger n, hence we can choose a smaller k
	%      to also represent the valence orbitals well (This is not true!)
	%    - Explains also why the valance orbitals only become bonding if basis is large enough
	%
	% Compute E-vs-k graph for a few examples.
	% Compute Orben vs k grapk

	% Larger lmax helps nothing fer the first 3 periods

	% Fit approximate formula for atomic number vs k_opt

	% Show convergence graph for eigenvalues (e.g. 311, 411, 511, 611, 711, ... for one example
	%       Go into largeness of the basis for proper description of the virtual orbitals
	% Show convergence graph for eigenvalues for k

	% m tuning not looked into very closely

	% TODO
	% FCI calculation of something to compare
	%       interpret FCI
	% Can one really make the argument that a smaller orbital energy value is a better approximation?

	% Smaller optimal exponent for the energy (physical argument):
	%   - Double counting of e-e interaction leads to electrons avoiding another
	%   - Hence smaller exponent (and higher effective energy, i.e. smaller magnitude)

	% Compare HF energy and HF orbital energies to CBS limit
}

\section{Comparison Sturmians and cGTOs}
\todo[inline,caption={}]{
	% Take the values already presented above
	% and contrast them
	% Maybe try to plot a FCI density and compare with the gaussian and sturmian HF density

	% Look at relative and not absolute errors

	\begin{itemize}
		\item Compute some crude calculations for the periodic table
		\item Use both atoms and a few ions
		\item Show some numbers for the comparison Sturmians - cGTOs
	\end{itemize}
	% Improve HF energy values by adding only s functions
	%         (leads to smaller basis sets and should still work)
}

\begin{table}
	\centering
	\begin{tabular}{lc|ccc|ccc}
		       &            & \multicolumn{3}{c}{\CS}     & \multicolumn{3}{c}{Gaussian} \\
		system & literature & basis & $\Nbas$ & relative error & basis & $\Nbas$ & relative error \\
	\end{tabular}
	\caption{Comparison of \CS and Gaussian results for a few example systems}
	\label{tab:CSvsGaussian}
	% TODO Just build this table at first summarising the results obtained.
	%      Do not yet do the Gaussian calculation
\end{table}

% TODO closed or half-shell ions are ready.


% Compare S1 and T1 of Beryllium with gaussian calculation of an equivalent basis at FCI
% Are we also better in capturing the correlation energy at FCI level?

% Super accurate Be FCI calculation for comparison
% Be FCI 10,2,2 k = 1.985  E_FCI = -14.663

\section{Sturmian-based ADC}

% For potassium l_max = m_max = 2 seems to be good for HF
% Do some more calculations to check the correlation effects
%
% We want the potassium 30s atomic orbital

\todo[inline,caption={}]{
	\begin{itemize}
		% TODO Can we actually do this?
		% Try to do the orbital rotation thingy
		\item hint at it or show some examples
		\item Maybe show comparison of convergence rates (rel. error vs. basis size)
			in the sensible Sturmian $nlm$ basis sets vs similar Gaussian ones
		\item Look at how the Gaussian basis sets have been constructed
			(especially the correlation consistent and pc-n ones)
			and compare how the Sturmians behave if similar
			Constructions are used, also motivated from the previous section.
	\end{itemize}
}
